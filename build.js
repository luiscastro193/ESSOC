!function(){"use strict";function e(e){return new Promise((e=>setTimeout((()=>e(null)),1500)))}window.htmlToElement=function(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild},window.AuxEvent=class{constructor(){this.event=document.createElement("e"),this.aux=new Event("e")}addListener(e,t){let n=this.event;n.addEventListener("e",(function a(){document.contains(e)?t():n.removeEventListener("e",a)}))}dispatch(){this.event.dispatchEvent(this.aux)}},window.Observable=class{constructor(e){this.variable=e,this.event=new AuxEvent}get value(){return this.variable}set value(e){this.variable=e,this.event.dispatch()}subscribe(e,t){this.event.addListener(e,t)}},window.dataPromise=async function(){let t;for(;!t;)t=await new Promise(((e,t)=>{let n=new XMLHttpRequest;n.open("GET","data.json"),n.responseType="json",n.onload=()=>{n.status<400?e(n.response):t(n.statusText)},n.onerror=()=>t(n.statusText),n.send()})).catch(e);return t}(),window.htmlData={title:document.querySelector("h1").innerText,header:document.querySelector("header").innerHTML,main:document.querySelector("main").innerHTML};let t=new Promise((e=>{document.head.querySelector("[data-id=vegaEmbed]").onload=()=>e()})),n=[];function a(e){if(document.body.contains(e[0]))return!0;e[1]()}function l(){alert("Copia el enlace de esta página para guardar la selección")}async function o(){let e=htmlToElement(`<header class="main-header-container">\n\t\t<a class="home-link" href="#"><i class="fa-solid fa-house"></i></a>\n\t\t<header class="main-header">\n\t\t\t<label for="main-info-checkbox"><h1>${htmlData.title} <span><i class="fa-solid fa-circle-info"></i></span></h1></label>\n\t\t\t<input id="main-info-checkbox" type="checkbox">\n\t\t\t<p class="main-info">${(await dataPromise).infoResultados}</p>\n\t\t</header>\n\t\t<section class="downloads">\n\t\t\t<span><i class="fa-solid fa-download"></i></span>\n\t\t\t<a role="link">Enlace</a>\n\t\t</section>\n\t</header>`);return e.querySelector(".downloads > a").onclick=share,e}function i(e){let t={};for(let n of Object.values(e.estimadores))for(let[e,a]of Object.entries(n))t[e]=a;return t}function s(e){let t=new URLSearchParams(location.hash.substring(1)),n={};for(let[e,a]of t)n[e]=a.split(" ");return function(e,t){let n=i(t);return!!(e.var&&e.est&&e.seg&&e.var.length&&e.est.length&&e.seg.length&&e.var.every((e=>t.variables[e]))&&e.est.every((e=>n[e]))&&e.seg.every((e=>t.segmentaciones[e])))}(n,e)&&n}async function r(){let e=location.hash,t=htmlToElement('<main class="results-page"></main>'),n=await dataPromise;if(e!=location.hash)return t;let a=s(n);if(!a)return location.hash="",t;let l=function(e,t){let n=new Map;for(let a of e.var){let l=t.variables[a].archivos,o=new Map;for(let t of e.est){let n=l[t];if(!n)continue;let a=new Map;for(let t of e.seg){let e=n[t];e&&a.set(t,e)}a.size&&o.set(t,a)}o.size&&n.set(a,o)}return n}(a,n);if(!l.size)return t.append(htmlToElement("<p>Ningún estimador seleccionado está disponible para las variables seleccionadas.</p>")),t;let o,r=i(n),c=0;if(a.seg.length>1?c=3:a.est.length>1?c=2:a.var.length>1&&(c=1),c>=1){o=htmlToElement('<h2 class="var-title">Índice de contenidos seleccionados</h2>'),t.append(o);for(let[e,a]of l.entries()){let l=htmlToElement(`<a class="index-link" role="link"><span>${n.variables[e].nombre}</span></a>`);if(l.onclick=()=>t.querySelector(`#var-${e}`).scrollIntoView(),t.append(l),c>=2)for(let[l,o]of a.entries()){let a=htmlToElement(`<a class="index-link" role="link">     <span>${r[l]}</span></a>`);if(a.onclick=()=>t.querySelector(`#var-${e}-est-${l}`).scrollIntoView(),t.append(a),c>=3)for(let a of o.keys()){let o=htmlToElement(`<a class="index-link" role="link">          <span>${n.segmentaciones[a]}</span></a>`);o.onclick=()=>t.querySelector(`#var-${e}-est-${l}-seg-${a}`).scrollIntoView(),t.append(o)}}}}function d(e){o.scrollIntoView(),e.preventDefault()}function h(){let e=htmlToElement('<a class="index-back"><i class="fa-solid fa-arrow-turn-up"></i></a>');return e.onclick=d,e}for(let[e,a]of l.entries()){let l=htmlToElement(`<h2 id="var-${e}" class="var-title">Variable seleccionada: ${n.variables[e].nombre}</h2>`);c>=1&&l.append(h()),t.append(l);for(let[l,o]of a.entries()){let a=htmlToElement(`<label id="var-${e}-est-${l}" for="${e}-${l}" class="est-title"><h2>Estimador seleccionado: ${r[l]} <span><i class="fa-solid fa-circle-info"></i></span></h2></label>`);c>=2&&a.append(h()),t.append(a,htmlToElement(`<input id="${e}-${l}" type="checkbox">`),htmlToElement(`<p>${n.descripciones[l]}</p>`));for(let[a,i]of o.entries()){let o=htmlToElement(`<h2 id="var-${e}-est-${l}-seg-${a}" class="est-title">Segmentación seleccionada: ${n.segmentaciones[a]}</h2>`);c>=3&&o.append(h()),t.append(o);for(let e of i){let n=htmlToElement('<div class="chart-container"><div></div></div>');loadChart(n.querySelector("div"),`data/${e}.json`),t.append(n)}}}}return t}function c(e,t){return htmlToElement(`<label><input ${t?`name="${t}"`:""} type="checkbox"><span>${e}</span></label>`)}function d(e,t){let n=e.querySelector("input"),a=t.map((e=>e.querySelector("input")));function l(){a.every((e=>e.checked))?n.checked=!0:a.some((e=>!e.checked))&&(n.checked=!1)}n.addEventListener("change",(()=>{for(let e of a)e.checked=n.checked}));for(let e of a)e.addEventListener("change",l)}function h(e){return[...new FormData(e).keys()]}async function p(){let e=htmlToElement(`<main class="selection-page">${htmlData.main}</main>`),t=0,n=await dataPromise,a=e.querySelector("#var-selection");for(let[e,l]of Object.entries(n.bloques)){let o=htmlToElement(`<div>\n\t\t\t<input id="block${++t}-checkbox" type="checkbox">\n\t\t\t<label for="block${t}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>\n\t\t</div>`),i=c("Todas"),s=l.map((e=>c(n.variables[e].nombre,e)));d(i,s),o.append(i,...s),a.append(o)}let l=e.querySelector("#est-selection"),o=c("Todas las tablas");l.append(o);let i=[];for(let[e,a]of Object.entries(n.estimadores)){let n=htmlToElement(`<div>\n\t\t\t<input id="block${++t}-checkbox" type="checkbox">\n\t\t\t<label for="block${t}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>\n\t\t</div>`),o=Object.entries(a).map((e=>c(e[1],e[0])));i.push(...o),n.append(...o),l.append(n)}d(o,i);let s,r=e.querySelector("#seg-selection"),p=c("Todas"),u=Object.entries(n.segmentaciones).map((e=>c(e[1],e[0])));d(p,u),r.append(p,...u);let m=e.querySelector(".main-button");function f(){s={var:h(a),est:h(l),seg:h(r)},m.disabled=!Object.values(s).every((e=>e.length))}for(let t of e.querySelectorAll("input:not([id])"))t.addEventListener("change",f);m.addEventListener("click",(function(){m.disabled=!0,function(e){let t=new URLSearchParams(Object.entries(e).map((e=>[e[0],e[1].join(" ")])));location.hash="?"+t.toString()}(s)}));let v=e.querySelectorAll(".distr-link > span:last-of-type"),b=[n.descripciones.evolution,n.descripciones.distribution];for(let e=0;e<v.length;e++)v[e].onclick=function(t){t.preventDefault(),alert(b[e])};return e}function u(){let e=htmlToElement('<main class="results-page">\n\t\t<label for="evolution-checkbox" class="est-title"><h2>Descripción de las mediciones <span><i class="fa-solid fa-circle-info"></i></span></h2></label>\n\t\t<input id="evolution-checkbox" type="checkbox">\n\t\t<p>Cargando...</p>\n\t\t<div class="chart-container"><div></div></div>\n\t</main>');return loadChart(e.querySelector(".chart-container > div"),"data/evolution.json"),dataPromise.then((t=>e.querySelector("p").innerHTML=t.descripciones.evolution)),e}window.loadChart=async function(e,a){await t;let l=(await vegaEmbed(e,function(){let e=location.pathname;return e.endsWith("/")?e:e+"/"}()+a,{renderer:"canvas"})).finalize;setTimeout((()=>n.push([e,l])),0)},setInterval((function(){n=n.filter(a)}),1e3),window.share=function(){navigator.share?navigator.share({url:location.href}):navigator.clipboard?navigator.clipboard.writeText(location.href).then((()=>alert("Enlace copiado al portapapeles"))).catch(l):l()};let m=0;async function f(){scrollTo(0,0);let e,t,n=++m,a=location.hash;a.length>1&&"?"==a[1]?[e,t]=[o(),r()]:[e,t]="#/evolution"==a?[htmlToElement(`<header class="main-header">\n\t\t<a href="#"><h1>${htmlData.title}</h1></a>\n\t</header>`),u()]:[htmlToElement(`<header class="main-header-container main-selection-header">\n\t\t${htmlData.header}\n\t</header>`),p()],[e,t]=await Promise.all([e,t]),n==m&&(document.querySelector("header").replaceWith(e),document.querySelector("main").replaceWith(t))}window.onpopstate=f,f()}();
