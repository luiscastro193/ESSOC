!function(){"use strict";function e(e){return new Promise((e=>setTimeout((()=>e(null)),1500)))}window.htmlToElement=function(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild},window.AuxEvent=class{constructor(){this.event=document.createElement("e"),this.aux=new Event("e")}addListener(e,t){let n=this.event;n.addEventListener("e",(function a(){document.contains(e)?t():n.removeEventListener("e",a)}))}dispatch(){this.event.dispatchEvent(this.aux)}},window.Observable=class{constructor(e){this.variable=e,this.event=new AuxEvent}get value(){return this.variable}set value(e){this.variable=e,this.event.dispatch()}subscribe(e,t){this.event.addListener(e,t)}},window.dataPromise=async function(){let t;for(;!t;)t=await new Promise(((e,t)=>{let n=new XMLHttpRequest;n.open("GET","data.json"),n.responseType="json",n.onload=()=>{n.status<400?e(n.response):t(n.statusText)},n.onerror=()=>t(n.statusText),n.send()})).catch(e);return t}(),window.htmlData={title:document.querySelector("h1").innerText,header:document.querySelector("header").innerHTML,main:document.querySelector("main").innerHTML};let t=new Promise((e=>{document.head.querySelector("[data-id=vegaEmbed]").onload=()=>e()})),n=[];async function a(e,t){let[n,a]=e.split(";");if(n=`${function(){let e=location.pathname;return e.endsWith("/")?e:e+"/"}()}data/${n}.json`,a=a.split(","),a.every((e=>t.includes(e))))return n;let l=await async function(e,t){let n=await fetch(e,t);if(n.ok)return n;throw n}(n).then((e=>e.text())),i=t.map((e=>`indexof(datum.M, '${e}') != -1`)).join(" || ");return JSON.parse(l.replace("indexof(datum.M, 'M') != -1",i))}function l(e){if(document.body.contains(e[0]))return!0;e[1]()}function i(){alert("Copia el enlace de esta página para guardar la selección")}async function o(){let e=htmlToElement(`<header class="main-header-container">\n\t\t<a class="home-link" href="#"><i class="fa-solid fa-house"></i></a>\n\t\t<header class="main-header">\n\t\t\t<label for="main-info-checkbox"><h1>${htmlData.title} <span><i class="fa-solid fa-circle-info"></i></span></h1></label>\n\t\t\t<input id="main-info-checkbox" type="checkbox">\n\t\t\t<p class="main-info">${(await dataPromise).infoResultados}</p>\n\t\t</header>\n\t\t<section class="downloads">\n\t\t\t<span><i class="fa-solid fa-download"></i></span>\n\t\t\t<a role="link">Enlace</a>\n\t\t</section>\n\t</header>`);return e.querySelector(".downloads > a").onclick=share,e}function s(e){let t={};for(let n of Object.values(e.estimadores))for(let[e,a]of Object.entries(n))t[e]=a;return t}function r(e){let t=new URLSearchParams(location.hash.substring(1)),n={};for(let[e,a]of t)n[e]=a.split(" ");return function(e,t){let n=s(t);return!!(e.var&&e.est&&e.seg&&e.m&&e.var.length&&e.est.length&&e.seg.length&&e.m.length&&e.var.every((e=>t.variables[e]))&&e.est.every((e=>n[e]))&&e.seg.every((e=>t.segmentaciones[e]))&&e.m.every((e=>t.mediciones[e])))}(n,e)&&n}function c(e,t){return e.split(";")[1].split(",").some((e=>t.includes(e)))}async function d(){let e=location.hash,t=htmlToElement('<main class="results-page"></main>'),n=await dataPromise;if(e!=location.hash)return t;let a=r(n);if(!a)return location.hash="",t;let l=function(e,t){let n=new Map;for(let a of e.var){let l=t.variables[a].archivos,i=new Map;for(let t of e.est){let n=l[t];if(!n)continue;let a=new Map;for(let t of e.seg){let l=n[t];l&&(l=l.filter((t=>c(t,e.m)))),l.length&&a.set(t,l)}a.size&&i.set(t,a)}i.size&&n.set(a,i)}return n}(a,n);if(!l.size)return t.append(htmlToElement("<p>Ningún estimador seleccionado está disponible para las variables y mediciones seleccionadas.</p>")),t;let i,o=s(n),d=0;if(a.seg.length>1?d=3:a.est.length>1?d=2:a.var.length>1&&(d=1),d>=1){i=htmlToElement('<h2 class="var-title">Índice de contenidos seleccionados</h2>'),t.append(i);for(let[e,a]of l.entries()){let l=htmlToElement(`<a class="index-link" role="link"><span>${n.variables[e].nombre}</span></a>`);if(l.onclick=()=>t.querySelector(`#var-${e}`).scrollIntoView(),t.append(l),d>=2)for(let[l,i]of a.entries()){let a=htmlToElement(`<a class="index-link indent" role="link"><span>${o[l]}</span></a>`);if(a.onclick=()=>t.querySelector(`#var-${e}-est-${l}`).scrollIntoView(),t.append(a),d>=3)for(let a of i.keys()){let i=htmlToElement(`<a class="index-link indent-2" role="link"><span>${n.segmentaciones[a]}</span></a>`);i.onclick=()=>t.querySelector(`#var-${e}-est-${l}-seg-${a}`).scrollIntoView(),t.append(i)}}}}function h(e){i.scrollIntoView(),e.preventDefault()}function p(){let e=htmlToElement('<a class="index-back"><i class="fa-solid fa-arrow-turn-up"></i></a>');return e.onclick=h,e}for(let[e,i]of l.entries()){let l=htmlToElement(`<h2 id="var-${e}" class="var-title">Variable seleccionada: ${n.variables[e].nombre}</h2>`);d>=1&&l.append(p()),t.append(l);for(let[l,s]of i.entries()){let i=htmlToElement(`<label id="var-${e}-est-${l}" for="${e}-${l}" class="est-title"><h2>Estimador seleccionado: ${o[l]} <span><i class="fa-solid fa-circle-info"></i></span></h2></label>`);d>=2&&i.append(p()),t.append(i,htmlToElement(`<input id="${e}-${l}" type="checkbox">`),htmlToElement(`<p>${n.descripciones[l]}</p>`));for(let[i,o]of s.entries()){let s=htmlToElement(`<h2 id="var-${e}-est-${l}-seg-${i}" class="est-title">Segmentación seleccionada: ${n.segmentaciones[i]}</h2>`);d>=3&&s.append(p()),t.append(s);for(let e of o){let n=htmlToElement('<div class="chart-container"><div></div></div>');loadChart(n.querySelector("div"),e,a.m),t.append(n)}}}}return t}function h(e,t){return htmlToElement(`<label><input ${t?`name="${t}"`:""} type="checkbox"><span>${e}</span></label>`)}function p(e,t){let n=e.querySelector("input"),a=t.map((e=>e.querySelector("input")));function l(){a.every((e=>e.checked))?n.checked=!0:a.some((e=>!e.checked))&&(n.checked=!1)}n.addEventListener("change",(()=>{for(let e of a)e.checked=n.checked}));for(let e of a)e.addEventListener("change",l)}function u(e){return[...new FormData(e).keys()]}async function m(){let e=htmlToElement(`<main class="selection-page">${htmlData.main}</main>`),t=0,n=await dataPromise,a=e.querySelector("#var-selection");for(let[e,l]of Object.entries(n.bloques)){let i=htmlToElement(`<div>\n\t\t\t<input id="block${++t}-checkbox" type="checkbox">\n\t\t\t<label for="block${t}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>\n\t\t</div>`),o=h("Todas"),s=l.map((e=>h(n.variables[e].nombre,e)));p(o,s),i.append(o,...s),a.append(i)}let l=e.querySelector("#est-selection"),i=h("Todas las tablas");l.append(i);let o=[];for(let[e,a]of Object.entries(n.estimadores)){let n=htmlToElement(`<div>\n\t\t\t<input id="block${++t}-checkbox" type="checkbox">\n\t\t\t<label for="block${t}-checkbox"><span>${e}</span><span><i class="fa-solid fa-play"></i></span></label>\n\t\t</div>`),i=Object.entries(a).map((e=>h(e[1],e[0])));o.push(...i),n.append(...i),l.append(n)}p(i,o);let s=e.querySelector("#seg-selection"),r=h("Todas"),c=Object.entries(n.segmentaciones).map((e=>h(e[1],e[0])));p(r,c),s.append(r,...c);let d,m=e.querySelector("#m-selection"),f=h("Todas"),v=Object.entries(n.mediciones).map((e=>h(e[1],e[0])));p(f,v),m.append(f,...v);let b=e.querySelector(".main-button");function y(){d={var:u(a),est:u(l),seg:u(s),m:u(m)},b.disabled=!Object.values(d).every((e=>e.length))}for(let t of e.querySelectorAll("input:not([id])"))t.addEventListener("change",y);return b.addEventListener("click",(function(){b.disabled=!0,function(e){let t=new URLSearchParams(Object.entries(e).map((e=>[e[0],e[1].join(" ")])));location.hash="?"+t.toString()}(d)})),function(e,t){let n=e.querySelectorAll(".distr-link > span:last-of-type"),a=[t.descripciones.evolution,t.descripciones.distribution];for(let e=0;e<n.length;e++)n[e].onclick=function(t){t.preventDefault(),alert(a[e])}}(e,n),e}function f(){let e=htmlToElement('<main class="results-page">\n\t\t<label for="evolution-checkbox" class="est-title"><h2>Descripción de las mediciones <span><i class="fa-solid fa-circle-info"></i></span></h2></label>\n\t\t<input id="evolution-checkbox" type="checkbox">\n\t\t<p>Cargando...</p>\n\t\t<div class="chart-container"><div></div></div>\n\t</main>');return loadChart(e.querySelector(".chart-container > div"),"data/evolution.json"),dataPromise.then((t=>e.querySelector("p").innerHTML=t.descripciones.evolution)),e}window.loadChart=async function(e,l,i){await t;let o=(await vegaEmbed(e,await a(l,i),{renderer:"canvas"})).finalize;setTimeout((()=>n.push([e,o])),0)},setInterval((function(){n=n.filter(l)}),1e3),window.share=function(){navigator.share?navigator.share({url:location.href}):navigator.clipboard?navigator.clipboard.writeText(location.href).then((()=>alert("Enlace copiado al portapapeles"))).catch(i):i()};let v=0;async function b(){scrollTo(0,0);let e,t,n=++v,a=location.hash;a.length>1&&"?"==a[1]?[e,t]=[o(),d()]:[e,t]="#/evolution"==a?[htmlToElement(`<header class="main-header">\n\t\t<a href="#"><h1>${htmlData.title}</h1></a>\n\t</header>`),f()]:[htmlToElement(`<header class="main-header-container main-selection-header">\n\t\t${htmlData.header}\n\t</header>`),m()],[e,t]=await Promise.all([e,t]),n==v&&(document.querySelector("header").replaceWith(e),document.querySelector("main").replaceWith(t))}window.onpopstate=b,b()}();
